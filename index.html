<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Daily Focus ‚úì</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;500&display=swap" rel="stylesheet">
  <style>
    html {
      box-sizing: border-box;
    }

    *, *:before, *:after {
      box-sizing: inherit;
    }

    body {
      --grid-color: #ddd;
      --grid-weight: 1px;
      --grid-spacing: 32px;
      --accent: #a78bfa;
      --bg: #f9f9f9;
      --text: #000;
      --surface: #fff;
      --shadow: rgba(0, 0, 0, 0.1);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      margin: 0;
      padding: 20px;
      background-color: var(--bg);
      background-position:
        center center,
        center center;
      background-size:
        var(--grid-spacing) var(--grid-spacing),
        var(--grid-spacing) var(--grid-spacing);
      background-image:
        linear-gradient(to bottom, var(--accent), transparent),
        repeating-linear-gradient(
          0deg,
          var(--grid-color),
          var(--grid-color) var(--grid-weight),
          transparent var(--grid-weight),
          transparent var(--grid-spacing)
        ),
        repeating-linear-gradient(
          -90deg,
          var(--grid-color),
          var(--grid-color) var(--grid-weight),
          transparent var(--grid-weight),
          transparent var(--grid-spacing)
        );
      color: var(--text);
      font-family: 'IBM Plex Mono', monospace;
      font-size: 16px;
      transition: all 0.3s ease;
    }

    body.dark-mode {
      --grid-color: #333;
      --bg: #111;
      --text: #fff;
      --surface: #1a1a1a;
      --shadow: rgba(255, 255, 255, 0.1);
      background-image:
        linear-gradient(to bottom, var(--accent), transparent),
        repeating-linear-gradient(
          0deg,
          var(--grid-color),
          var(--grid-color) var(--grid-weight),
          transparent var(--grid-weight),
          transparent var(--grid-spacing)
        ),
        repeating-linear-gradient(
          -90deg,
          var(--grid-color),
          var(--grid-color) var(--grid-weight),
          transparent var(--grid-weight),
          transparent var(--grid-spacing)
        );
    }

    #root {
      display: flex;
      align-items: center;
      justify-content: center;
      flex: 1 1 auto;
      width: 100%;
    }

    .contain {
      width: 100%;
      max-width: 800px;
      padding: 32px;
      background: rgba(255, 255, 255, 0.9);
      backdrop-filter: blur(10px);
      border: 2px solid var(--text);
      box-shadow: -8px 8px 0px 0px var(--text);
      transition: all 0.3s ease;
    }

    body.dark-mode .contain {
      background: rgba(26, 26, 26, 0.9);
    }

    .header {
      text-align: center;
      margin-bottom: 32px;
      position: relative;
    }

    .header h1 {
      font-size: 2.5em;
      margin: 0 0 8px 0;
      color: var(--text);
    }

    .subtitle {
      font-size: 14px;
      opacity: 0.6;
      margin-bottom: 24px;
    }

    .streak-badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 8px 16px;
      background: var(--accent);
      color: white;
      border-radius: 20px;
      font-size: 14px;
      font-weight: 500;
      margin-top: 12px;
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }

    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-10px); }
      75% { transform: translateX(10px); }
    }

    .shake {
      animation: shake 0.5s;
    }

    @keyframes checkPop {
      0% { transform: scale(0); opacity: 0; }
      50% { transform: scale(1.2); }
      100% { transform: scale(1); opacity: 1; }
    }

    .check-pop {
      animation: checkPop 0.3s ease;
    }

    .theme-toggle {
      position: absolute;
      top: 0;
      right: 0;
      background: var(--surface);
      border: 2px solid var(--text);
      padding: 8px 16px;
      cursor: pointer;
      font-family: 'IBM Plex Mono', monospace;
      font-size: 14px;
      box-shadow: -3px 3px 0px 0px var(--text);
      transition: all 0.2s ease;
    }

    .theme-toggle:hover {
      box-shadow: -2px 2px 0px 0px var(--text);
      transform: translate(-1px, 1px);
    }

    .progress-text {
      text-align: center;
      margin-bottom: 16px;
      font-size: 18px;
      font-weight: 500;
      color: var(--accent);
    }

    .progress-bar-container {
      height: 8px;
      background: var(--surface);
      border: 2px solid var(--text);
      margin-bottom: 24px;
      overflow: hidden;
    }

    .progress-bar {
      height: 100%;
      background: var(--accent);
      transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1);
      width: 0%;
      box-shadow: 0 0 10px var(--accent);
    }

    .confetti-container {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 9999;
    }

    .confetti {
      position: absolute;
      font-size: 24px;
      animation: confettiFall 3s ease-out forwards;
    }

    @keyframes confettiFall {
      0% {
        transform: translateY(0) rotate(0deg);
        opacity: 1;
      }
      100% {
        transform: translateY(100vh) rotate(720deg);
        opacity: 0;
      }
    }

    ul {
      list-style: none;
      margin: 0;
      padding: 0;
    }

    input {
      display: block;
      width: 100%;
      background: var(--surface);
      padding: 16px;
      margin: 0 0 24px 0;
      border: 2px solid var(--text);
      box-shadow: -4px 4px 0px 0px var(--text);
      font-family: 'IBM Plex Mono', monospace;
      font-size: 16px;
      cursor: text;
      color: var(--text);
      transition: all 0.2s ease;
    }

    input:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: -4px 4px 0px 0px var(--accent);
    }

    input:hover {
      box-shadow: -2px 2px 0px 0px var(--text);
    }

    .todo-input {
      margin-bottom: 32px;
    }

    li {
      display: flex;
      align-items: center;
      gap: 12px;
      background: var(--surface);
      padding: 16px;
      margin: 12px 0;
      border: 2px solid var(--text);
      box-shadow: -4px 4px 0px 0px var(--text);
      cursor: pointer;
      transition: all 0.3s ease;
      animation: slideIn 0.3s ease;
      position: relative;
    }

    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateY(-20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes fadeOut {
      from {
        opacity: 1;
        transform: scale(1);
      }
      to {
        opacity: 0;
        transform: scale(0.8);
      }
    }

    li.removing {
      animation: fadeOut 0.3s ease forwards;
    }

    .checkbox {
      width: 20px;
      height: 20px;
      border: 2px solid var(--text);
      border-radius: 50%;
      flex-shrink: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s ease;
    }

    .checkbox:hover {
      border-color: var(--accent);
      background: rgba(var(--accent), 0.1);
    }

    .checkbox.checked {
      background: var(--accent);
      border-color: var(--accent);
    }

    .checkbox.checked::after {
      content: '‚úì';
      color: white;
      font-size: 14px;
      font-weight: bold;
    }

    .todo-text {
      flex: 1;
      word-break: break-word;
      transition: opacity 0.3s ease;
    }

    .todo-text-edit {
      flex: 1;
      padding: 4px 8px;
      margin: 0;
      font-family: 'IBM Plex Mono', monospace;
      font-size: 16px;
      border: 2px solid var(--accent);
      background: var(--surface);
      color: var(--text);
      box-shadow: none;
    }

    .remove {
      position: relative;
      height: 16px;
      width: 16px;
      padding: 0;
      flex: 0 0 16px;
      border: none;
      appearance: none;
      background: transparent;
      cursor: pointer;
      opacity: 0.5;
      transition: opacity 0.2s ease;
    }

    .remove:hover {
      opacity: 1;
    }

    .remove::before,
    .remove::after {
      content: '';
      position: absolute;
      top: 0;
      left: calc(50% - 1px);
      height: 100%;
      width: 2px;
      background: var(--text);
    }

    .remove::before {
      transform: rotate(-45deg);
    }

    .remove::after {
      transform: rotate(45deg);
    }

    .remove:focus {
      outline: none;
      opacity: 1;
    }

    li:hover {
      transform: translateY(-2px);
      box-shadow: -6px 8px 0px 0px var(--text);
    }

    li.complete {
      opacity: 0.5;
    }

    li.complete .todo-text {
      text-decoration: line-through;
      opacity: 0.6;
    }
  

    .empty-state {
      text-align: center;
      padding: 48px;
      opacity: 0.5;
      font-size: 18px;
    }

    .footer {
      text-align: center;
      margin-top: 32px;
      padding-top: 24px;
      border-top: 2px solid var(--text);
      opacity: 0.7;
      font-size: 14px;
    }

    .quote {
      margin-bottom: 12px;
    }

    .stats-footer {
      font-size: 12px;
      opacity: 0.6;
    }

    .save-indicator {
      margin-top: 8px;
      font-size: 12px;
      color: var(--accent);
      opacity: 0;
      transition: opacity 0.3s ease;
    }
  </style>
</head>
<body>
  <div id="root">
    <div class="contain">
      <div class="header">
        <button class="theme-toggle" id="themeToggle">üåô Dark</button>
        <h1>Daily Focus</h1>
        <div class="subtitle" id="subtitle">One task at a time üí™</div>
        <div class="streak-badge" id="streakBadge">üî• 0 Day Streak</div>
      </div>

      <div class="progress-text" id="progressText">0/0 done - Let's start!</div>
      <div class="progress-bar-container">
        <div class="progress-bar" id="progressBar"></div>
      </div>

      <div class="todo-input">
        <form id="todoForm">
          <input
            type="text"
            id="todoInput"
            placeholder="What needs to be done today? ‚ú®"
            autocomplete="off"
          />
        </form>
      </div>

      <ul id="todoList"></ul>

      <div class="footer">
        <div class="quote" id="quote">One task at a time üí™</div>
        <div class="stats-footer" id="statsFooter">Total completed: 0</div>
        <div class="save-indicator" id="saveIndicator">‚úì Saved</div>
      </div>
    </div>
  </div>

  <script>
    // State
    let todos = [];
    let stats = {
      streak: 0,
      totalCompleted: 0,
      lastVisit: null,
      todayCompleted: 0
    };
    let isDarkMode = false;
    let currentAccent = '#a78bfa';

    // Motivational quotes
    const quotes = [
      "One task at a time üí™",
      "Progress over perfection ‚ú®",
      "You've got this! üöÄ",
      "Small steps, big wins üéØ",
      "Keep the momentum going üî•",
      "Today is your day ‚òÄÔ∏è",
      "Make it happen ‚ö°"
    ];

    // Get time-based accent color
    function getAccentColor() {
      const hour = new Date().getHours();
      if (hour >= 6 && hour < 12) return '#a78bfa'; // Morning: soft purple
      if (hour >= 12 && hour < 18) return '#fb923c'; // Afternoon: warm orange
      if (hour >= 18 && hour < 24) return '#38bdf8'; // Evening: cool blue
      return '#818cf8'; // Night: deep indigo
    }

    // Update accent color
    function updateAccentColor() {
      currentAccent = getAccentColor();
      document.documentElement.style.setProperty('--accent', currentAccent);
    }

    // Get daily quote
    function getDailyQuote() {
      const dayOfYear = Math.floor((new Date() - new Date(new Date().getFullYear(), 0, 0)) / 86400000);
      return quotes[dayOfYear % quotes.length];
    }

    // NOTE: This app uses in-memory storage due to sandbox security restrictions.
    // localStorage/sessionStorage are blocked in sandboxed iframes.
    // Data persists during the session but resets on page reload.
    
    console.log('üîç Checking storage availability...');
    console.log('‚ö†Ô∏è Sandbox environment: localStorage blocked by security policy');
    console.log('‚úì Using in-memory state management');
    
function loadTodos() {
  const stored = localStorage.getItem('todos');
  if (stored) {
    todos = JSON.parse(stored);
  } else {
    todos = [];
  }
}

function saveTodos() {
  localStorage.setItem('todos', JSON.stringify(todos));
  showSaveIndicator();
}

function loadStats() {
  const stored = localStorage.getItem('stats');
  if (stored) {
    stats = JSON.parse(stored);
  } else {
    stats = {
      streak: 0,
      totalCompleted: 0,
      lastVisit: new Date().toDateString(),
      todayCompleted: 0
    };
  }
}

function saveStats() {
  localStorage.setItem('stats', JSON.stringify(stats));
}

function loadTheme() {
  const stored = localStorage.getItem('theme');
  if (stored) {
    isDarkMode = stored === 'dark';
  }
  return isDarkMode;
}

function saveTheme() {
  localStorage.setItem('theme', isDarkMode ? 'dark' : 'light');
}

    
    function showSaveIndicator() {
      // Visual feedback that data was saved
      const indicator = document.getElementById('saveIndicator');
      if (indicator) {
        indicator.style.opacity = '1';
        setTimeout(() => {
          indicator.style.opacity = '0';
        }, 1500);
      }
    }

    // Update streak
    function updateStreak() {
      const today = new Date().toDateString();
      const yesterday = new Date(Date.now() - 86400000).toDateString();
      
      // Check if we need to update streak
      if (stats.lastVisit !== today) {
        const todayCompleted = todos.filter(t => 
          t.isComplete && t.completedAt && 
          new Date(t.completedAt).toDateString() === today
        ).length;
        
        if (todayCompleted > 0) {
          if (stats.lastVisit === yesterday) {
            stats.streak++;
          } else if (stats.lastVisit !== today) {
            stats.streak = 1;
          }
          stats.lastVisit = today;
          saveStats();
        } else if (stats.lastVisit !== yesterday && stats.lastVisit !== today) {
          stats.streak = 0;
        }
      }
      
      // Update UI
      const streakBadge = document.getElementById('streakBadge');
      streakBadge.textContent = `üî• ${stats.streak} Day Streak${stats.streak !== 1 ? '' : ''}`;
    }

    // Update progress
    function updateProgress() {
      const total = todos.length;
      const completed = todos.filter(t => t.isComplete).length;
      const progress = total > 0 ? (completed / total) * 100 : 0;

      // Update progress bar
      document.getElementById('progressBar').style.width = progress + '%';
      
      // Update progress text
      const progressText = document.getElementById('progressText');
      if (total === 0) {
        progressText.textContent = "Let's start your day! ‚òÄÔ∏è";
      } else if (completed === 0) {
        progressText.textContent = `0/${total} done - You've got this! üí™`;
      } else if (completed === total) {
        progressText.textContent = `${completed}/${total} done - All complete! üéâ`;
      } else {
        const percentage = Math.round(progress);
        const messages = [
          `${completed}/${total} done - Great start! üöÄ`,
          `${completed}/${total} done - Keep going! ‚ö°`,
          `${completed}/${total} done - You're crushing it! üî•`,
          `${completed}/${total} done - Almost there! ‚ú®`
        ];
        const index = Math.min(Math.floor(progress / 25), messages.length - 1);
        progressText.textContent = messages[index];
      }
      
      // Update footer stats
      document.getElementById('statsFooter').textContent = `Total completed: ${stats.totalCompleted}`;
      
      // Update streak
      updateStreak();
      
      // Check for completion celebration
      if (total > 0 && completed === total) {
        celebrate();
      }
    }

    // Celebration animation
    function celebrate() {
      const confettiContainer = document.createElement('div');
      confettiContainer.className = 'confetti-container';
      document.body.appendChild(confettiContainer);
      
      const emojis = ['üéâ', '‚ú®', 'üéä', '‚≠ê', 'üí´', 'üåü'];
      
      for (let i = 0; i < 30; i++) {
        setTimeout(() => {
          const confetti = document.createElement('div');
          confetti.className = 'confetti';
          confetti.textContent = emojis[Math.floor(Math.random() * emojis.length)];
          confetti.style.left = Math.random() * 100 + '%';
          confetti.style.animationDuration = (Math.random() * 2 + 2) + 's';
          confetti.style.animationDelay = (Math.random() * 0.5) + 's';
          confettiContainer.appendChild(confetti);
          
          setTimeout(() => confetti.remove(), 3500);
        }, i * 50);
      }
      
      setTimeout(() => confettiContainer.remove(), 4000);
    }

    // Render todos to the DOM
    function renderTodos() {
      const todoList = document.getElementById('todoList');
      const sortedTodos = [...todos].sort((a, b) => a.createdAt - b.createdAt);

      if (todos.length === 0) {
        todoList.innerHTML = '<div class="empty-state">No todos yet. Add one above! üìù</div>';
        updateProgress();
        return;
      }

      todoList.innerHTML = '';

      sortedTodos.forEach((todo) => {
        const li = document.createElement('li');
        li.className = todo.isComplete ? 'complete' : '';
        li.setAttribute('tabindex', '0');
        li.setAttribute('data-id', todo.id);
        
        // Make entire li clickable to toggle complete (unless in edit mode)
        if (!todo.editMode) {
          li.addEventListener('click', (e) => {
            // Only toggle if not clicking on delete button or already in edit
            if (!e.target.classList.contains('remove') && 
                !e.target.closest('.remove') &&
                !e.target.classList.contains('todo-text-edit')) {
              handleComplete(todo.id);
            }
          });
        }



        // Checkbox (visual indicator only, clicking anywhere toggles)
        const checkbox = document.createElement('div');
        checkbox.className = 'checkbox';
        if (todo.isComplete) {
          checkbox.classList.add('checked');
        }

        // Todo text or edit input
        if (todo.editMode) {
          const editInput = document.createElement('input');
          editInput.type = 'text';
          editInput.className = 'todo-text-edit';
          editInput.value = todo.text;
          editInput.addEventListener('blur', () => saveEdit(todo.id, editInput.value));
          editInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
              saveEdit(todo.id, editInput.value);
            }
          });
          editInput.addEventListener('click', (e) => e.stopPropagation());
          setTimeout(() => editInput.focus(), 0);
          li.appendChild(checkbox);
          li.appendChild(editInput);
        } else {
          const textDiv = document.createElement('div');
          textDiv.className = 'todo-text';
          textDiv.textContent = todo.text;
          // Double-click to edit (stop propagation to prevent toggle)
          textDiv.addEventListener('dblclick', (e) => {
            e.stopPropagation();
            enterEditMode(todo.id);
          });
          li.appendChild(checkbox);
          li.appendChild(textDiv);
        }

        // Remove button
        if (!todo.editMode) {
          const removeBtn = document.createElement('button');
          removeBtn.className = 'remove';
          removeBtn.setAttribute('aria-label', 'Remove todo');
          removeBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            handleRemove(todo.id);
          });
          li.appendChild(removeBtn);
        }

        todoList.appendChild(li);
      });

      updateProgress();
    }

    // Add new todo
    function addTodo(text) {
      const newTodo = {
        id: Date.now(),
        text,
        isComplete: false,
        createdAt: Date.now(),
        completedAt: null,
        editMode: false
      };
      todos.push(newTodo);
      saveTodos();
      renderTodos();
    }

    // Toggle complete status
    function handleComplete(id) {
      const todo = todos.find(t => t.id === id);
      if (todo) {
        todo.isComplete = !todo.isComplete;
        todo.completedAt = todo.isComplete ? Date.now() : null;
        
        if (todo.isComplete) {
          stats.totalCompleted++;
          stats.todayCompleted++;
          saveStats();
        } else {
          stats.totalCompleted = Math.max(0, stats.totalCompleted - 1);
          stats.todayCompleted = Math.max(0, stats.todayCompleted - 1);
          saveStats();
        }
        
        saveTodos();
        renderTodos();
      }
    }

    // Remove todo with animation
    function handleRemove(id) {
      const li = document.querySelector(`[data-id="${id}"]`);
      if (li) {
        li.classList.add('removing');
        setTimeout(() => {
          const index = todos.findIndex(t => t.id === id);
          if (index !== -1) {
            const todo = todos[index];
            if (todo.isComplete) {
              stats.totalCompleted = Math.max(0, stats.totalCompleted - 1);
              saveStats();
            }
            todos.splice(index, 1);
            saveTodos();
            renderTodos();
          }
        }, 300);
      }
    }

    // Enter edit mode
    function enterEditMode(id) {
      const todo = todos.find(t => t.id === id);
      if (todo) {
        todo.editMode = true;
        renderTodos();
      }
    }

    // Save edit
    function saveEdit(id, newText) {
      const todo = todos.find(t => t.id === id);
      if (todo) {
        todo.text = newText.trim() || todo.text;
        todo.editMode = false;
        saveTodos();
        renderTodos();
      }
    }

    // Toggle theme
    function toggleTheme() {
      isDarkMode = !isDarkMode;
      document.body.classList.toggle('dark-mode', isDarkMode);
      document.getElementById('themeToggle').textContent = isDarkMode ? '‚òÄÔ∏è Light' : 'üåô Dark';
      saveTheme();
    }

    // Handle form submission
    function handleSubmit(e) {
      e.preventDefault();
      const input = document.getElementById('todoInput');
      const text = input.value.trim();
      
      if (!text) {
        // Shake animation for empty input
        input.classList.add('shake');
        setTimeout(() => input.classList.remove('shake'), 500);
        return;
      }
      
      addTodo(text);
      input.value = '';
      input.focus();
    }

    // Initialize app
    function init() {
      // Load theme
      isDarkMode = loadTheme();
      if (isDarkMode) {
        document.body.classList.add('dark-mode');
        document.getElementById('themeToggle').textContent = '‚òÄÔ∏è Light';
      }

      // Load data
      console.log('üöÄ Initializing Daily Focus app...');
      loadStats();
      loadTodos();
      
      // Set accent color based on time
      updateAccentColor();
      
      // Set daily quote
      document.getElementById('quote').textContent = getDailyQuote();
      document.getElementById('subtitle').textContent = getDailyQuote();
      
      // Render
      renderTodos();
      
      // Event listeners
      const form = document.getElementById('todoForm');
      form.addEventListener('submit', handleSubmit);

      const themeToggle = document.getElementById('themeToggle');
      themeToggle.addEventListener('click', toggleTheme);
      
      // Update accent color every minute
      setInterval(updateAccentColor, 60000);
    }

    // Start the app when DOM is ready
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', init);
    } else {
      init();
    }
  </script>
</body>
</html>